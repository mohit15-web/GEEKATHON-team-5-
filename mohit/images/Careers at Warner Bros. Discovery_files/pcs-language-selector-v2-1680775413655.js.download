!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("vue"),require("../../../../common/v1/src")):"function"==typeof def&&def.amd?def("pcs-language-selector-v2",["vue","../../../../common/v1/src"],t):((e=e||self).phw=e.phw||{},e.phw.PcsLanguageSelectorV2=t(e.Vue,e.PcsCommon))}(this,function(h,n){"use strict";h=h&&h.hasOwnProperty("default")?h.default:h,n=n&&n.hasOwnProperty("default")?n.default:n;var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};function e(e,t,o,r){var n,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;0<=s;s--)(n=e[s])&&(i=(a<3?n(i):3<a?n(t,o,i):n(t,o))||i);return 3<a&&i&&Object.defineProperty(t,o,i),i}function l(o,r){var n,a,i,e,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,a&&(i=2&t[0]?a.return:t[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,t[1])).done)return i;switch(a=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,a=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(i=0<(i=s.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){s.label=t[1];break}if(6===t[0]&&s.label<i[1]){s.label=i[1],i=t;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(t);break}i[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(o,s)}catch(e){t=[6,e],a=0}finally{n=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}var f="undefined"!=typeof Reflect&&Reflect.defineMetadata&&Reflect.getOwnMetadataKeys;function d(o,r,n){(n?Reflect.getOwnMetadataKeys(r,n):Reflect.getOwnMetadataKeys(r)).forEach(function(e){var t=n?Reflect.getOwnMetadata(e,r,n):Reflect.getOwnMetadata(e,r);n?Reflect.defineMetadata(e,t,o,n):Reflect.defineMetadata(e,t,o)})}var y={__proto__:[]}instanceof Array;function g(e){"undefined"!=typeof console&&console.warn("[vue-class-component] "+e)}var v=["data","beforeCreate","created","beforeMount","mounted","beforeDestroy","destroyed","beforeUpdate","updated","activated","deactivated","render","errorCaptured","serverPrefetch"];function r(e,r){void 0===r&&(r={}),r.name=r.name||e._componentTag||e.name;var n=e.prototype;Object.getOwnPropertyNames(n).forEach(function(t){if("constructor"!==t)if(-1<v.indexOf(t))r[t]=n[t];else{var o=Object.getOwnPropertyDescriptor(n,t);void 0!==o.value?"function"==typeof o.value?(r.methods||(r.methods={}))[t]=o.value:(r.mixins||(r.mixins=[])).push({data:function(){var e;return(e={})[t]=o.value,e}}):(o.get||o.set)&&((r.computed||(r.computed={}))[t]={get:o.get,set:o.set})}}),(r.mixins||(r.mixins=[])).push({data:function(){return function(r,e){var t=e.prototype._init;e.prototype._init=function(){var e=this,t=Object.getOwnPropertyNames(r);if(r.$options.props)for(var o in r.$options.props)r.hasOwnProperty(o)||t.push(o);t.forEach(function(t){"_"!==t.charAt(0)&&Object.defineProperty(e,t,{get:function(){return r[t]},set:function(e){r[t]=e},configurable:!0})})};var o=new e;e.prototype._init=t;var n={};return Object.keys(o).forEach(function(e){void 0!==o[e]&&(n[e]=o[e])}),!(e.prototype instanceof h)&&0<Object.keys(n).length&&g("Component class must inherit Vue or its descendant class when class property is used."),n}(this,e)}});var t=e.__decorators__;t&&(t.forEach(function(e){return e(r)}),delete e.__decorators__);var i,s,c,o,a,l=Object.getPrototypeOf(e.prototype),p=l instanceof h?l.constructor:h,u=p.extend(r);return i=u,s=e,c=p,Object.getOwnPropertyNames(s).forEach(function(e){if(!w[e]){var t=Object.getOwnPropertyDescriptor(i,e);if(!t||t.configurable){var o,r,n=Object.getOwnPropertyDescriptor(s,e);if(!y){if("cid"===e)return;var a=Object.getOwnPropertyDescriptor(c,e);if(o=n.value,r=typeof o,null!=o&&("object"==r||"function"==r)&&a&&a.value===n.value)return}0<=m.indexOf(e)&&g("Static property name '"+e+"' declared on class '"+s.name+"' conflicts with reserved property name of Vue internal. It may cause unexpected behavior of the component. Consider renaming the property."),Object.defineProperty(i,e,n)}}}),f&&(d(o=u,a=e),Object.getOwnPropertyNames(a.prototype).forEach(function(e){d(o.prototype,a.prototype,e)}),Object.getOwnPropertyNames(a).forEach(function(e){d(o,a,e)})),u}var m=["cid","super","options","superOptions","extendOptions","sealedOptions","component","directive","filter"],w={prototype:!0,arguments:!0,callee:!0,caller:!0};function t(t){return"function"==typeof t?r(t):function(e){return r(e,t)}}t.registerHooks=function(e){v.push.apply(v,e)};var s="undefined"!=typeof Reflect&&void 0!==Reflect.getMetadata;function a(i){return void 0===i&&(i={}),function(e,t){var o,r,n,a;o=i,r=e,n=t,s&&(Array.isArray(o)||"function"==typeof o||void 0!==o.type||(o.type=Reflect.getMetadata("design:type",r,n))),a=function(e,t){(e.props||(e.props={}))[t]=i},function(e,t,o){var r="function"==typeof e?e:e.constructor;r.__decorators__||(r.__decorators__=[]),"number"!=typeof o&&(o=void 0),r.__decorators__.push(function(e){return a(e,t,o)})}(e,t)}}var p={v2:{ddoKey:"getRegionLocales",ddoKeySaveProfile:"editProfile",ddoKeyVideoScreen:"getVideoScreenLocales"}},i=(c.prototype.makeDDORequest=function(t,e){return n.FetchService.fetchDdo(t,e).then(function(e){return e&&e[t]})},c);function c(){}var u,b,O,D=function(){this.samePage=!1,this.sortOption="alphabet",this.sortType="locale",this.saveProfile=!1,this.isErrorMsgReqd=!1},R="pcs-language-selector-v2",S="modal-open";function _(){this.constructor=b}function P(){var e=null!==u&&u.apply(this,arguments)||this;return e.elementTag=R,e.bindableModel=new D,e.languageSelectorService=new i,e.phenomAppManager=n.PhenomAppManager,e.searchFilter=n.SearchFilter,e.showErrorMsg=!1,e.languageCount=[],e.roots=[],e.searchArray=[],e.choosenLanguage={},e.choosenLocation={},e.levelSize=0,e.currentLevel=0,e.isSelected=!1,e.filterTodisplay=!1,e.filterKey="",e.isshowDropDown=!1,e.isDropDown=!1,e.resultsUpdated=!1,e.openModal=function(){e.isDropDown=!0,e.isshowDropDown=!0,document.body.classList.contains(S)||document.body.classList.add(S)},e.closeModal=function(){e.isDropDown=!1,e.isshowDropDown=!1,document.body.classList.contains(S)&&document.body.classList.remove(S)},e}return{component:(u=n.BaseComponent,o(b=P,O=u),b.prototype=null===O?Object.create(O):(_.prototype=O.prototype,new _),P.prototype.widgetReady=function(){this.element=this.$el,this.fetchRegionLocales()},P.prototype.fetchRegionLocales=function(){var o=this,e="ddoKey";this.videoScreen&&(e="ddoKeyVideoScreen"),this.languageSelectorService.makeDDORequest(p.v2[e],{}).then(function(e){if(e&&e.data)if(1<e.data.length){var r;if(o.flagResponse=e.data||[],o.videoScreen&&(r=window.location.href.replace(n.PhenomAppManager.getBaseUrl(),"")),o.flagResponse.forEach(function(e){var t="";if(e.locale&&(t=(t=(t=e.locale.split("_"))&&t[1]||"").toLowerCase()),e.flagCode=t,e.hasOwnProperty("id")&&(e.id=parseInt(e.id),r&&e.siteUrl&&(e.siteUrl=e.siteUrl+"/"+r)),!e.language){var o="";e.locale&&(o=(o=(o=e.locale.split("_"))&&o[0]||"").toLowerCase()),e.language=o}}),o.flagResponse.length){var t=o.flagResponse[0];t.hasOwnProperty("sortType")&&t.sortType&&(o.bindModel.sortType=t.sortType,"id"==t.sortType&&(o.bindModel.sortOption="source"))}"alphabet"===o.bindModel.sortOption&&o.flagResponse.sort(o.getSortOrder(o.bindModel.sortType)),"source"===o.bindModel.sortOption&&o.flagResponse.sort(o.getSortOrder("id")),o.getTreeStructure()}else o.hideContainer();else o.handleError("");o.hideLoader(),o.languageChanged(o.choosenLanguage,!0,!0)},function(e){o.handleError("")}),document.addEventListener("click",function(e){var t=e.target;o.element&&!o.element.contains(t)&&(o.isDropDown=!1,o.isshowDropDown=!1)},!1)},P.prototype.getTreeStructure=function(){var e,t,o=this,r={};for(e=0;e<this.flagResponse.length;e+=1)this.flagResponse[e].siteUrl&&0<this.flagResponse[e].siteUrl.length&&(this.flagResponse[e].siteUrl=this.checkForUrlPath(this.flagResponse[e].siteUrl)),this.flagResponse[e].isAvailableInMenu&&(r[this.flagResponse[e].id]=e,this.flagResponse[e].children=[]);for(e=0;e<this.flagResponse.length;e+=1){var n=this.phenomAppManager.getLocale()||"";this.flagResponse[e].isAvailableInMenu&&(this.flagResponse[e].locale===n&&(this.choosenLanguage=this.flagResponse[e]),this.flagResponse[e].location===this.phenomAppManager.getCountry()&&(this.choosenLocation=this.flagResponse[e]),t=this.flagResponse[e],this.roots.push(t),this.searchArray.push(t),null!==t.parentId&&this.flagResponse[r[t.parentId]]&&this.flagResponse[r[t.parentId]].children.push(t))}this.roots.forEach(function(e){if(e.locale){var t=e.locale.split("_")[0];-1===o.languageCount.indexOf(t)&&o.languageCount.push(t)}}),this.roots.forEach(function(e){if(e.locale){var t=o.getDepth(e);e.level=t,e.displayName=e.displayName||""}}),this.searchArray.forEach(function(e){e.displayName=e.displayName||""}),this.createUrl()},P.prototype.getDepth=function(e){var o=this,r=1;return e.children&&0<e.children.length&&(this.flagResponse.sort(this.getSortOrder("locale")),e.children.forEach(function(e){var t=o.getDepth(e)+1;r=Math.max(t,r)})),r},P.prototype.getSortOrder=function(o){return function(e,t){return e[o]>t[o]?1:e[o]<t[o]?-1:0}},P.prototype.toggleDropdown=function(e){e.stopPropagation(),this.isshowDropDown=!this.isshowDropDown},P.prototype.sortArray=function(e){this.roots=this.searchFilter(this.searchArray,e,"displayName")},P.prototype.clearSearch=function(){this.filterKey="",this.sortArray(""),this.isshowDropDown=!0,n.CommonService.focusElement(".ph-a11y-search-area input",100,this.element)},P.prototype.checkForUrlPath=function(e){var t=this.getUrlString(e);return t.pathname&&null!=t.pathname&&""!==t.pathname&&"/"!==t.pathname?e:e+"/home"},P.prototype.getUrlString=function(e){var t=document.createElement("a");return t.href=e,{protocol:t.protocol,hostname:t.hostname,port:t.port,pathname:t.pathname,search:t.search,hash:t.hash,host:t.host}},P.prototype.languageChanged=function(e,t,o){if(!e||t)return!0;var r={};r.localeName=e.locale,o||this.trackWidgetClick("locale",r),this.bindModel.saveProfile&&this.saveProfileLocale(e);var n=e.siteUrl;this.bindModel.samePage&&(n+=location.pathname,location.search&&0<location.search.trim().length&&(n+=location.search)),location.assign(n)},P.prototype.saveProfileLocale=function(n){return a=this,c=function(){var t,o,r;return l(this,function(e){switch(e.label){case 0:return t=p.v2.ddoKeySaveProfile,o={editType:"accountDetails",accountDetails:{preferredLocale:n.locale}},[4,this.languageSelectorService.makeDDORequest(t,o)];case 1:if(200===(r=e.sent()).status||"SUCCESS"===r.status.toUpperCase())return[2];throw new Error("Error in saving profile locale")}})},new(s=(s=i=void 0)||Promise)(function(e,t){function o(e){try{n(c.next(e))}catch(e){t(e)}}function r(e){try{n(c.throw(e))}catch(e){t(e)}}function n(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(o,r)}n((c=c.apply(a,i||[])).next())});var a,i,s,c},P.prototype.createUrl=function(){for(var e=0;e<this.roots.length;e++)if(this.roots[e]){var t=this.roots[e].siteUrl;this.bindModel.samePage&&(t+=location.pathname,location.search&&0<location.search.trim().length&&(t+=location.search)),this.roots[e].locationUrl=t}},P.prototype.getFieldOptions=function(e){var o=this;if(this.filterKey.length){if(null!=this.element){var t=this.element.querySelector(".ph-a11y-dropdown-box .ph-a11y-search-area input");t&&t.hasAttribute("aria-activedescendant")&&t.removeAttribute("aria-activedescendant")}this.roots&&(this.roots=this.searchArray.reduce(function(e,t){return t.primaryDisplayName&&t.displayName&&e.push(t),e},[]),this.roots=this.searchFilter(this.roots,this.filterKey,"displayName")),this.languageCount=[],this.roots.forEach(function(e){if(e.locale){var t=e.locale.split("_")[0];-1===o.languageCount.indexOf(t)&&o.languageCount.push(t)}})}else this.roots=JSON.parse(JSON.stringify(this.searchArray));return this.resultsUpdated=!0,setTimeout(function(){o.resultsUpdated=!1},50),this.$forceUpdate(),this.roots},P.prototype.setFieldValue=function(e,t){if(this.roots.length&&this.roots[t]&&(this.filterKey=this.roots[t].displayName,null!=this.element)){var o=this.element.querySelector(".listitem-focused a");this.fireClick(o)}},P.prototype.getActiveIndex=function(e){var t=this;return this.roots.findIndex(function(e){return e.displayName===t.filterKey})},P.prototype.fireClick=function(e){if(document.createEvent){var t=document.createEvent("MouseEvents");t.initEvent("click",!0,!1),e.dispatchEvent(t)}else document.createEventObject?e.fireEvent("onclick"):"function"==typeof e.onclick&&e.onclick()},P.prototype.onBlurHandler=function(e,t){var o=this;return t?(this.blurTimers&&clearTimeout(this.blurTimers),this.isDropDown=!0,this.isshowDropDown=!0):(this.blurTimers&&clearTimeout(this.blurTimers),this.blurTimers=setTimeout(function(){o.isDropDown=!1,o.isshowDropDown=!1},300)),!0},P.prototype.showDropdown=function(){this.isshowDropDown=!this.isshowDropDown;var e=document.querySelector('[id="language-selector"]');e&&n.CommonService.focusElement(e,100,this.element)},e([a()],P.prototype,"videoScreen",void 0),P=e([t({name:R})],P))}});
